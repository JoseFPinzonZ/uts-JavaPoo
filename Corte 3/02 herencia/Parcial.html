<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Título de pestaña -->
    <title>Oficina de Redes UTS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body class="px-50 pt-5">
    <div class="container">
        <div class="row">

            <!--Inicio nueva columna en el body -->
            <div class="col-sm me-2">
                <div class="card w-100">
                    <div class="card-header">
                        Registro de Practicantes Oficina de Redes
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm me-2">
                                <form id="practicanteForm">

                                    <div class="mb-3">
                                        <label for="nombre" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="inputNombre" placeholder="Nombre"
                                            required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="edad" class="form-label">Edad</label>
                                        <input type="number" class="form-control" id="inputEdad" placeholder="Edad" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="sexo" class="form-label">Sexo</label>
                                        <select class="form-select" id="inputSexo" required>
                                            <option value="" selected disabled>Seleccionar</option>
                                            <option value="masculino">Masculino</option>
                                            <option value="femenino">Femenino</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="correo" class="form-label">Correo Electrónico</label>
                                        <input type="email" class="form-control" id="inputCorreo" placeholder="Correo"
                                            required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="nota1" class="form-label">Nota Telemática 1</label>
                                        <input type="number" class="form-control" id="inputNota1" step="0.1"
                                            placeholder="Nota 1" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="nota2" class="form-label">Nota Telemática 2</label>
                                        <input type="number" class="form-control" id="inputNota2" step="0.1"
                                            placeholder="Nota 2" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="nota3" class="form-label">Nota Telemática 3</label>
                                        <input type="number" class="form-control" id="inputNota3" step="0.1"
                                            placeholder="Nota 3" required>
                                    </div>

                                    <div class="mb-3 d-flex justify-content-between">
                                        <!-- Dispara la funcion registrarPracticante al accionar el boton Registrar
                                            Practicante -->
                                        <button type="button" class="btn btn-primary"
                                            onclick="registrarPracticante()">Registrar Practicante</button>
                                        <!-- Dispara la funcion limpiarFormularioPracticantes al accionar el boton Limpiar 
                                            Registro -->
                                        <button type="button" class="btn btn-primary"
                                            onclick="limpiarFormularioPracticantes()">Limpiar Registro</button>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Final nueva columna en el body --->

            <!-- Inicio Registro de horas --->
            <div class="col-sm ms-2">

                <div class="card w-100">
                    <div class="card-header">
                        Registro de Horas Practicantes
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm me-2">
                                <form id="horasForm">
                                    <div class="col-sm me-2">
                                        <!-- Menú desplegable de practicantes admitidos -->
                                        <label for="practicanteAdmitido" class="form-label">Practicante</label>
                                        <select class="form-select" id="inputPracticanteAdmitido">
                                            <option value="" selected disabled>Seleccionar Practicante</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="horasTrabajadas" class="form-label">Horas Trabajadas</label>
                                        <input type="number" class="form-control" id="inputHorasTrabajadas"
                                            placeholder="Horas Trabajadas">
                                    </div>

                                    <!-- label para mostrar el total de horas acumuladas -->
                                    <div class="mb-3">
                                        <label for="totalHoras" class="form-label">Total de Horas Acumuladas</label>
                                        <label id="labelTotalHoras" class="form-control" style="height: 35px"></label>
                                    </div>

                                    <div class="mb-3">
                                        <!-- Botón para añadir horas -->
                                        <button type="button" class="btn btn-primary" onclick="agregarHoras()">Añadir
                                            Horas</button>
                                        <!--Botón para limpiar formulario horas -->
                                        <button type="button" class="btn btn-primary"
                                            onclick="limpiarFormularioHoras()">Limpiar Registro</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Inicio Información Registrada --->

                <div class="card">
                    <div class="card-header">
                        Información Registrada
                    </div>
                    <div class="card-body">
                        <table id="tablaPracticantes" class="table">
                            <tr>
                                <th style="text-align: center; font-size: 20px;">Nombre</th>
                                <th style="text-align: center; font-size: 20px;">Edad</th>
                                <th style="text-align: center; font-size: 20px;">Sexo</th>
                                <th style="text-align: center; font-size: 20px;">Correo</th>
                                <th style="text-align: center; white-space: nowrap; font-size: 20px;">Telemática 1</th>
                                <th style="text-align: center; white-space: nowrap; font-size: 20px;">Telemática 2</th>
                                <th style="text-align: center; white-space: nowrap; font-size: 20px;">Telemática 3</th>
                                <th style="text-align: center; font-size: 20px;">Estado</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Final nueva columna en el body -->
        </div>
    </div>
    <!--Inicio codigo JS-->

    <script>

        let Practicantes = [];
        let practicanteInst;

        //Clase practicante
        class Practicante {
            constructor(nombre, edad, sexo, correo, nota1, nota2, nota3) {

                this.nombre = nombre;
                this.edad = edad;
                this.sexo = sexo;
                this.correo = correo;
                this.nota1 = nota1;
                this.nota2 = nota2;
                this.nota3 = nota3;
                this.estado = this.calcularAdmision();
                this.horas = 0;
            }
            //Metodos(Fuciones) dentro del constructor

            validacionDatos() {

                //Validacion campo nombre no este vacio en el formulario        
                if (this.nombre == '') {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Nombre no puede estar vacio', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.edad == '') {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Edad no puede estar vacia', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.edad < 16) {
                    Swal.fire({ position: 'center', icon: 'error', title: 'Valide datos', text: 'Para realizar practicas debes tener al menos 16 años', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.sexo == '') {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Sexo no puede estar vacio', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.correo == '') {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Correo no puede estar vacio', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (!this.correo.includes('@')) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Formato de correo invalido', showConfirmButton: false, timer: 4000 });
                    return false;
                }

                if (isNaN(this.nota1)) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Nota 1 no puede estar vacia', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.nota1 < 0 || this.nota1 > 5) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'La nota 1 debe estar entre 0 y 5', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (isNaN(this.nota2)) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Nota 2 no puede estar vacia', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.nota2 < 0 || this.nota2 > 5) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'La nota 2 debe estar entre 0 y 5', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (isNaN(this.nota3)) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Nota 3 no puede estar vacia', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                if (this.nota3 < 0 || this.nota3 > 5) {
                    Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'La nota 3 debe estar entre 0 y 5', showConfirmButton: false, timer: 4000 })
                    return false;
                }

                return true;

            }

            calcularAdmision() {

                return (this.nota1 >= 3.5 && this.nota2 >= 3.5 && this.nota3 >= 3.5) ? 'Admitido' : 'Denegado';
            }

            agregarPracticante() {

                if (this.validacionDatos() !== true) {
                    // Si las validaciones fallan, no hacemos nada más
                    return;
                }

                limpiarFormularioPracticantes();

                //Registro Exitoso
                Swal.fire({ position: 'center', icon: 'success', title: 'Registro Exitoso', text: 'Felicitaciones!', showConfirmButton: false, timer: 3000 })

                Practicantes.push({ nombre: this.nombre, edad: this.edad, sexo: this.sexo, correo: this.correo, nota1: this.nota1, nota2: this.nota2, nota3: this.nota3, estado: this.estado, horas: this.horas });

                var tabla = document.getElementById("tablaPracticantes");
                var fila = tabla.insertRow(1);

                var celdaNombre = fila.insertCell(0);
                var celdaEdad = fila.insertCell(1);
                var celdaSexo = fila.insertCell(2);
                var celdaCorreo = fila.insertCell(3);
                var celdaNota1 = fila.insertCell(4);
                var celdaNota2 = fila.insertCell(5);
                var celdaNota3 = fila.insertCell(6);
                var celdaEstado = fila.insertCell(7);


                // Aplicar estilos de centrado a las celdas de datos
                celdaNombre.style.textAlign = "center";
                celdaEdad.style.textAlign = "center";
                celdaSexo.style.textAlign = "center";
                celdaCorreo.style.textAlign = "center";
                celdaNota1.style.textAlign = "center";
                celdaNota2.style.textAlign = "center";
                celdaNota3.style.textAlign = "center";
                celdaEstado.style.textAlign = "center";

                celdaNombre.innerHTML = this.nombre;
                celdaEdad.innerHTML = this.edad;
                celdaSexo.innerHTML = this.sexo;
                celdaCorreo.innerHTML = this.correo;
                celdaNota1.innerHTML = this.nota1;
                celdaNota2.innerHTML = this.nota2;
                celdaNota3.innerHTML = this.nota3;

                // Utilizar la función calcularAdmision para determinar Admitido/Denegado
                var estadoAdmision = this.calcularAdmision();
                celdaEstado.innerHTML = estadoAdmision;

                // Agregar practicante a la lista si es admitido
                if (estadoAdmision === 'Admitido') {
                    actualizarMenuDesplegable();
                }
            }

        }

        //Funciones fuera del constructor 

        const limpiarFormularioPracticantes = () => {
            document.getElementById('inputNombre').value = '';
            document.getElementById('inputEdad').value = '';
            document.getElementById('inputSexo').value = '';
            document.getElementById('inputCorreo').value = '';
            document.getElementById('inputNota1').value = '';
            document.getElementById('inputNota2').value = '';
            document.getElementById('inputNota3').value = '';

        }

        const registrarPracticante = () => {
            console.clear();
            let nombreInsert = document.getElementById('inputNombre').value;
            let edadInsert = document.getElementById('inputEdad').value;
            let sexoInsert = document.getElementById('inputSexo').value;
            let correoInsert = document.getElementById('inputCorreo').value;
            let nota1Insert = parseFloat(document.getElementById('inputNota1').value);
            let nota2Insert = parseFloat(document.getElementById('inputNota2').value);
            let nota3Insert = parseFloat(document.getElementById('inputNota3').value);

            //Instanciar Practicante
            practicanteInst = new Practicante(nombreInsert, edadInsert, sexoInsert, correoInsert, nota1Insert, nota2Insert, nota3Insert)
            console.log(practicanteInst);

            //Disparar el metodo agregarPracticante
            practicanteInst.agregarPracticante();

        }

        const actualizarMenuDesplegable = () => {
            // Obtener el menú desplegable
            var menuDesplegable = document.getElementById("inputPracticanteAdmitido");

            // Limpiar el menú desplegable
            menuDesplegable.innerHTML = '<option value="" selected disabled>Seleccionar Practicante</option>';

            // Agregar practicantes admitidos al menú desplegable
            Practicantes.forEach(practicante => {
                if (practicante.estado === 'Admitido') {
                    var option = document.createElement("option");
                    option.text = practicante.nombre;
                    menuDesplegable.add(option);
                }
            });
        }

        // Función para actualizar el labelTotalHoras cuando cambia el practicante seleccionado
        const actualizarHorasPorPracticante = () => {
            //lINEA DE PRUEBA QUE SI SE EJECUTA LA FUNCION 
            //console.log("Función actualizarHorasPorPracticante ejecutada");

            // Obtener el practicante seleccionado en el menú desplegable
            const practicanteSeleccionado = document.getElementById('inputPracticanteAdmitido').value;

            // Encontrar el índice del objeto Practicante correspondiente en la lista
            const indicePracticante = Practicantes.findIndex(p => p.nombre === practicanteSeleccionado);

            // Validar que se haya encontrado el practicante
            if (indicePracticante === -1) {
                Swal.fire({ position: 'center', icon: 'info', title: 'Error', text: 'No se encontró el practicante seleccionado', showConfirmButton: false, timer: 4000 });
                return;
            }

            // Mostrar las horas actuales del practicante en el labelTotalHoras
            document.getElementById('labelTotalHoras').innerHTML = Practicantes[indicePracticante].horas;
        };

        const agregarHoras = () => {
            // Obtener el valor de las horas trabajadas
            const horasTrabajadas = parseFloat(document.getElementById('inputHorasTrabajadas').value);

            // Validar que se haya ingresado un valor numérico
            if (isNaN(horasTrabajadas)) {
                Swal.fire({ position: 'center', icon: 'info', title: 'Valide datos', text: 'Ingrese un valor numérico para las horas trabajadas', showConfirmButton: false, timer: 4000 });
                return;
            }


            // Obtener el practicante seleccionado en el menú desplegable
            const practicanteSeleccionado = document.getElementById('inputPracticanteAdmitido').value;

            // Encontrar el índice del objeto Practicante correspondiente en la lista
            const indicePracticante = Practicantes.findIndex(p => p.nombre === practicanteSeleccionado);

            // Validar que se haya encontrado el practicante
            if (indicePracticante === -1) {
                Swal.fire({ position: 'center', icon: 'info', title: 'Error', text: 'No se encontró el practicante seleccionado', showConfirmButton: false, timer: 4000 });
                return;
            }

            // Agregar las horas trabajadas al practicante en el array
            Practicantes[indicePracticante].horas += horasTrabajadas;
            practicanteInst.horas += horasTrabajadas;

            // Actualizar el campo 'totalHoras' en el HTML usando innerHTML
            document.getElementById('labelTotalHoras').innerHTML = Practicantes[indicePracticante].horas;
            document.getElementById('inputHorasTrabajadas').value = '';
            console.clear();
            console.log(Practicantes);
            console.log(practicanteInst);
        };

        const limpiarFormularioHoras = () => {
            document.getElementById('inputPracticanteAdmitido').value = '';
            document.getElementById('inputHorasTrabajadas').value = '';
            document.getElementById('labelTotalHoras').innerHTML = '';

        };
        // Asociar la función actualizarHorasPorPracticante al evento de cambio en el menú desplegable
        document.getElementById('inputPracticanteAdmitido').addEventListener('change', actualizarHorasPorPracticante);
    </script>
</body>

</html>